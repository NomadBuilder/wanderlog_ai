<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WanderLog AI - Frontend Tests</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .test-container {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .test-section {
      margin: 20px 0;
      padding: 15px;
      border-left: 4px solid #007bff;
      background: #f8f9fa;
    }
    
    .test-result {
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      font-weight: bold;
    }
    
    .test-pass {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .test-fail {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .test-skip {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .test-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    
    .test-button:hover {
      background: #0056b3;
    }
    
    .test-button:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
    
    .test-output {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 5px;
      padding: 10px;
      margin: 10px 0;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .progress-bar {
      width: 100%;
      height: 20px;
      background: #e9ecef;
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: #007bff;
      transition: width 0.3s ease;
    }
  </style>
</head>
<body>
  <h1>üß™ WanderLog AI - Frontend Test Suite</h1>
  
  <div class="test-container">
    <h2>Test Controls</h2>
    <button class="test-button" onclick="runAllTests()">Run All Tests</button>
    <button class="test-button" onclick="runExportTests()">Run Export Tests</button>
    <button class="test-button" onclick="runUITests()">Run UI Tests</button>
    <button class="test-button" onclick="clearResults()">Clear Results</button>
    
    <div class="progress-bar">
      <div class="progress-fill" id="progressBar" style="width: 0%"></div>
    </div>
    
    <div id="testSummary"></div>
  </div>
  
  <div class="test-container">
    <h2>Test Results</h2>
    <div id="testResults"></div>
  </div>

  <script>
    // Test configuration
    const TEST_CONFIG = {
      totalTests: 0,
      passedTests: 0,
      failedTests: 0,
      skippedTests: 0
    };
    
    // Mock data for testing
    const MOCK_STORY = {
      country: "France",
      cities: ["Paris", "Lyon"],
      visit_date: "2024-06-15",
      narrative: "An amazing journey through the beautiful cities of France. The Eiffel Tower was breathtaking, and the food in Lyon was absolutely incredible. The people were friendly and the culture was rich with history.",
      story_id: "test_123"
    };
    
    // Test utilities
    function log(message) {
      console.log(`[TEST] ${message}`);
    }
    
    function createTestResult(testName, passed, message = "", details = null) {
      const resultDiv = document.createElement('div');
      resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
      
      const status = passed ? '‚úÖ PASS' : '‚ùå FAIL';
      resultDiv.innerHTML = `<strong>${status}: ${testName}</strong>`;
      
      if (message) {
        resultDiv.innerHTML += `<br>${message}`;
      }
      
      if (details) {
        const detailsDiv = document.createElement('div');
        detailsDiv.className = 'test-output';
        detailsDiv.textContent = JSON.stringify(details, null, 2);
        resultDiv.appendChild(detailsDiv);
      }
      
      return resultDiv;
    }
    
    function updateProgress() {
      const progress = (TEST_CONFIG.passedTests / TEST_CONFIG.totalTests) * 100;
      document.getElementById('progressBar').style.width = `${progress}%`;
      
      document.getElementById('testSummary').innerHTML = `
        <strong>Test Summary:</strong><br>
        Total: ${TEST_CONFIG.totalTests} | 
        Passed: ${TEST_CONFIG.passedTests} | 
        Failed: ${TEST_CONFIG.failedTests} | 
        Skipped: ${TEST_CONFIG.skippedTests}
      `;
    }
    
    function addTestResult(resultDiv) {
      document.getElementById('testResults').appendChild(resultDiv);
    }
    
    // Test functions
    async function testCountryFlagFunction() {
      const testName = "Country Flag Function";
      log(`Running: ${testName}`);
      
      try {
        // Test if getCountryFlag function exists
        if (typeof getCountryFlag !== 'function') {
          return createTestResult(testName, false, "getCountryFlag function not found");
        }
        
        // Test with known countries
        const testCases = [
          { country: "France", expected: "üá´üá∑" },
          { country: "Japan", expected: "üáØüáµ" },
          { country: "United States", expected: "üá∫üá∏" }
        ];
        
        for (const testCase of testCases) {
          const result = getCountryFlag(testCase.country);
          if (result !== testCase.expected) {
            return createTestResult(testName, false, 
              `Expected ${testCase.expected} for ${testCase.country}, got ${result}`);
          }
        }
        
        return createTestResult(testName, true, "All country flag tests passed");
      } catch (error) {
        return createTestResult(testName, false, `Error: ${error.message}`);
      }
    }
    
    async function testDateFormatting() {
      const testName = "Date Formatting Function";
      log(`Running: ${testName}`);
      
      try {
        // Test if formatVisitDate function exists
        if (typeof formatVisitDate !== 'function') {
          return createTestResult(testName, false, "formatVisitDate function not found");
        }
        
        // Test with various date formats
        const testCases = [
          { input: "2024-06-15", expected: "June 2024" },
          { input: "2023-12-25", expected: "December 2023" },
          { input: "2025-01-01", expected: "January 2025" }
        ];
        
        for (const testCase of testCases) {
          const result = formatVisitDate(testCase.input);
          if (result !== testCase.expected) {
            return createTestResult(testName, false, 
              `Expected "${testCase.expected}" for "${testCase.input}", got "${result}"`);
          }
        }
        
        return createTestResult(testName, true, "All date formatting tests passed");
      } catch (error) {
        return createTestResult(testName, false, `Error: ${error.message}`);
      }
    }
    
    async function testTextExport() {
      const testName = "Text Export Function";
      log(`Running: ${testName}`);
      
      try {
        // Test if createTextContent function exists
        if (typeof createTextContent !== 'function') {
          return createTestResult(testName, false, "createTextContent function not found");
        }
        
        const textContent = createTextContent(MOCK_STORY);
        
        // Check if content contains expected elements
        const requiredElements = [
          "üá´üá∑ Travel Story: France",
          "Date: June 2024",
          "Cities: Paris, Lyon",
          MOCK_STORY.narrative,
          "Generated with WanderLog AI"
        ];
        
        for (const element of requiredElements) {
          if (!textContent.includes(element)) {
            return createTestResult(testName, false, 
              `Missing required element: "${element}"`);
          }
        }
        
        return createTestResult(testName, true, "Text export content validation passed", {
          contentLength: textContent.length,
          containsRequiredElements: true
        });
      } catch (error) {
        return createTestResult(testName, false, `Error: ${error.message}`);
      }
    }
    
    async function testDigitalAlbumExport() {
      const testName = "Digital Album Export Function";
      log(`Running: ${testName}`);
      
      try {
        // Test if createDigitalAlbumHTML function exists
        if (typeof createDigitalAlbumHTML !== 'function') {
          return createTestResult(testName, false, "createDigitalAlbumHTML function not found");
        }
        
        const albumHTML = createDigitalAlbumHTML(MOCK_STORY);
        
        // Check if HTML contains expected elements
        const requiredElements = [
          "<!DOCTYPE html>",
          "<title>France - Travel Album</title>",
          "üá´üá∑ France",
          "June 2024",
          "Paris, Lyon",
          MOCK_STORY.narrative,
          "Generated with WanderLog AI"
        ];
        
        for (const element of requiredElements) {
          if (!albumHTML.includes(element)) {
            return createTestResult(testName, false, 
              `Missing required element: "${element}"`);
          }
        }
        
        // Check if it's valid HTML structure
        if (!albumHTML.includes("<html") || !albumHTML.includes("</html>")) {
          return createTestResult(testName, false, "Invalid HTML structure");
        }
        
        return createTestResult(testName, true, "Digital album HTML validation passed", {
          contentLength: albumHTML.length,
          containsRequiredElements: true,
          validHTML: true
        });
      } catch (error) {
        return createTestResult(testName, false, `Error: ${error.message}`);
      }
    }
    
    async function testSocialMediaExport() {
      const testName = "Social Media Export Function";
      log(`Running: ${testName}`);
      
      try {
        // Test if createSocialMediaText function exists
        if (typeof createSocialMediaText !== 'function') {
          return createTestResult(testName, false, "createSocialMediaText function not found");
        }
        
        const socialMediaText = createSocialMediaText(MOCK_STORY);
        
        // Check if content contains expected elements
        const requiredElements = [
          "üá´üá∑ My adventure in France",
          "June 2024",
          "üìç Cities: Paris, Lyon",
          "‚úàÔ∏è Generated with WanderLog AI",
          "#Travel #France #WanderLogAI #TravelMemories"
        ];
        
        for (const element of requiredElements) {
          if (!socialMediaText.includes(element)) {
            return createTestResult(testName, false, 
              `Missing required element: "${element}"`);
          }
        }
        
        // Check if text is appropriate length for social media
        if (socialMediaText.length > 280) {
          return createTestResult(testName, false, 
            `Text too long for Twitter (${socialMediaText.length} characters)`);
        }
        
        return createTestResult(testName, true, "Social media text validation passed", {
          contentLength: socialMediaText.length,
          containsRequiredElements: true,
          twitterCompatible: socialMediaText.length <= 280
        });
      } catch (error) {
        return createTestResult(testName, false, `Error: ${error.message}`);
      }
    }
    
    async function testFileDownload() {
      const testName = "File Download Function";
      log(`Running: ${testName}`);
      
      try {
        // Test if downloadAsFile function exists
        if (typeof downloadAsFile !== 'function') {
          return createTestResult(testName, false, "downloadAsFile function not found");
        }
        
        // Mock the download functionality
        const originalCreateElement = document.createElement;
        let downloadLink = null;
        
        document.createElement = function(tagName) {
          if (tagName === 'a') {
            downloadLink = {
              href: '',
              download: '',
              click: function() {},
              style: { display: 'none' }
            };
            return downloadLink;
          }
          return originalCreateElement.call(document, tagName);
        };
        
        // Test the download function
        const testContent = "Test content";
        const testFilename = "test.txt";
        const testContentType = "text/plain";
        
        downloadAsFile(testContent, testFilename, testContentType);
        
        // Restore original function
        document.createElement = originalCreateElement;
        
        if (!downloadLink) {
          return createTestResult(testName, false, "Download link not created");
        }
        
        return createTestResult(testName, true, "File download function works correctly", {
          filename: testFilename,
          contentType: testContentType,
          contentLength: testContent.length
        });
      } catch (error) {
        return createTestResult(testName, false, `Error: ${error.message}`);
      }
    }
    
    async function testModalFunctions() {
      const testName = "Modal Functions";
      log(`Running: ${testName}`);
      
      try {
        // Test if modal functions exist
        const requiredFunctions = ['showModal', 'closeModal', 'showMessage'];
        const missingFunctions = [];
        
        for (const funcName of requiredFunctions) {
          if (typeof window[funcName] !== 'function') {
            missingFunctions.push(funcName);
          }
        }
        
        if (missingFunctions.length > 0) {
          return createTestResult(testName, false, 
            `Missing functions: ${missingFunctions.join(', ')}`);
        }
        
        return createTestResult(testName, true, "All modal functions found");
      } catch (error) {
        return createTestResult(testName, false, `Error: ${error.message}`);
      }
    }
    
    async function testStoryValidation() {
      const testName = "Story Data Validation";
      log(`Running: ${testName}`);
      
      try {
        // Test story object structure
        const requiredFields = ['country', 'cities', 'visit_date', 'narrative', 'story_id'];
        const missingFields = [];
        
        for (const field of requiredFields) {
          if (!(field in MOCK_STORY)) {
            missingFields.push(field);
          }
        }
        
        if (missingFields.length > 0) {
          return createTestResult(testName, false, 
            `Missing fields: ${missingFields.join(', ')}`);
        }
        
        // Test data types
        if (typeof MOCK_STORY.country !== 'string') {
          return createTestResult(testName, false, "Country should be a string");
        }
        
        if (!Array.isArray(MOCK_STORY.cities)) {
          return createTestResult(testName, false, "Cities should be an array");
        }
        
        if (typeof MOCK_STORY.narrative !== 'string') {
          return createTestResult(testName, false, "Narrative should be a string");
        }
        
        return createTestResult(testName, true, "Story data validation passed", {
          fieldCount: requiredFields.length,
          citiesCount: MOCK_STORY.cities.length,
          narrativeLength: MOCK_STORY.narrative.length
        });
      } catch (error) {
        return createTestResult(testName, false, `Error: ${error.message}`);
      }
    }
    
    // Test runners
    async function runExportTests() {
      log("Starting Export Tests...");
      document.getElementById('testResults').innerHTML = '';
      
      const exportTests = [
        testTextExport,
        testDigitalAlbumExport,
        testSocialMediaExport,
        testFileDownload
      ];
      
      TEST_CONFIG.totalTests = exportTests.length;
      TEST_CONFIG.passedTests = 0;
      TEST_CONFIG.failedTests = 0;
      TEST_CONFIG.skippedTests = 0;
      
      for (const test of exportTests) {
        const result = await test();
        addTestResult(result);
        
        if (result.className.includes('test-pass')) {
          TEST_CONFIG.passedTests++;
        } else if (result.className.includes('test-fail')) {
          TEST_CONFIG.failedTests++;
        } else {
          TEST_CONFIG.skippedTests++;
        }
        
        updateProgress();
      }
    }
    
    async function runUITests() {
      log("Starting UI Tests...");
      document.getElementById('testResults').innerHTML = '';
      
      const uiTests = [
        testCountryFlagFunction,
        testDateFormatting,
        testModalFunctions,
        testStoryValidation
      ];
      
      TEST_CONFIG.totalTests = uiTests.length;
      TEST_CONFIG.passedTests = 0;
      TEST_CONFIG.failedTests = 0;
      TEST_CONFIG.skippedTests = 0;
      
      for (const test of uiTests) {
        const result = await test();
        addTestResult(result);
        
        if (result.className.includes('test-pass')) {
          TEST_CONFIG.passedTests++;
        } else if (result.className.includes('test-fail')) {
          TEST_CONFIG.failedTests++;
        } else {
          TEST_CONFIG.skippedTests++;
        }
        
        updateProgress();
      }
    }
    
    async function runAllTests() {
      log("Starting All Tests...");
      document.getElementById('testResults').innerHTML = '';
      
      const allTests = [
        testCountryFlagFunction,
        testDateFormatting,
        testTextExport,
        testDigitalAlbumExport,
        testSocialMediaExport,
        testFileDownload,
        testModalFunctions,
        testStoryValidation
      ];
      
      TEST_CONFIG.totalTests = allTests.length;
      TEST_CONFIG.passedTests = 0;
      TEST_CONFIG.failedTests = 0;
      TEST_CONFIG.skippedTests = 0;
      
      for (const test of allTests) {
        const result = await test();
        addTestResult(result);
        
        if (result.className.includes('test-pass')) {
          TEST_CONFIG.passedTests++;
        } else if (result.className.includes('test-fail')) {
          TEST_CONFIG.failedTests++;
        } else {
          TEST_CONFIG.skippedTests++;
        }
        
        updateProgress();
        
        // Small delay to show progress
        await new Promise(resolve => setTimeout(resolve, 100));
      }
    }
    
    function clearResults() {
      document.getElementById('testResults').innerHTML = '';
      document.getElementById('testSummary').innerHTML = '';
      document.getElementById('progressBar').style.width = '0%';
      
      TEST_CONFIG.totalTests = 0;
      TEST_CONFIG.passedTests = 0;
      TEST_CONFIG.failedTests = 0;
      TEST_CONFIG.skippedTests = 0;
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      log("Frontend Test Suite Loaded");
      log("Note: Some tests may fail if the main WanderLog AI functions are not loaded");
    });
  </script>
</body>
</html> 